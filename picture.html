<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="layui/css/layui.css" media="all">
</head>

<body>
    <div class="layui-form">
        <table class="layui-table" id="newForm" lay-filter="newForm" style="margin:0;"></table>
    </div>
    <script type="text/html" id="barDemo">
        <a href="{{d.link}}" class="layui-btn layui-btn-primary layui-btn-xs" target="_blank">链接</a>
        <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
    </script>
    <script type="text/html" id="stateTpl">
        {{#  if(d.state === 0){ }}
            <span class="color_over">否</span>
          {{#  } else { }}
            <span class="color_start">是</span>
          {{#  } }}
    </script>
    <script type="text/html" id="imgTpl">
        <img src="{{d.image}}" alt="" style="max-width:100%;max-height:100%;">
    </script>
    <script src="layui/layui.js" charset="utf-8"></script>
    <script>
	var dev = 'http://10.0.1.76:3000',prod = '/',address = dev;
    layui.use([ 'form', 'layer', 'table', 'upload','laypage','element'], function() {
    	var form = layui.form,
            laypage = layui.laypage //分页
            ,
            layer = layui.layer //弹层
            ,
            table = layui.table //表格
            ,
            upload = layui.upload //上传
            ,
            $ = layui.jquery,
            element = layui.element;
        var tableIndes = table.render({
            elem: '#newForm',
            url: address + '/picture_date',
            // cellMinWidth: 100,
            page: true,
            cols: [
                [
                    { field: 'sort',title: '排序' },
                    { field: 'image', title: '图片', templet: '#imgTpl', align: 'center' },
                    { field: 'title', title: '描述'},
                    { field: 'state', title: '显示', templet: '#stateTpl'},
                    { field: 'datetimeStart', title: '生效时间' },
                    { field: 'datetimeEnd', title: '失效时间' },
                    { align: 'center',width:"200",title: '操作', toolbar: '#barDemo' }
                ]
            ]
        });
        //监听查看、编辑、删除、图片点击
        table.on('tool(newForm)', function(obj) {
            var data = obj.data;
            if (obj.event === 'del') {
                window.parent.parent.open_confirm(function(index){
                    $.get(address+'/delete_date',function(data){
                        if(!data.data){
                            window.parent.parent.open_layer(data.msg);
                            tableIndes.reload();//删除之后，重载
                        }else{
                            obj.del();
                        }
                    },'json')
                })
            } else if (obj.event === 'edit') {
                window.parent.parent.open_iframe({
                    title: '【编辑】 ' ,
                    area: ['800px', '500px'],
                    content: '/pictureinfo.html'
                });
            }
        });
    })
    </script>
</body>

</html>